#
# U-Boot Environment File for BeagleBone-Yocto Machines.
#
# U-boot should load and execute this file automatically.
#
# The default `bootcmd` will load this file and `run uenvcmd` if it is set.
#

#
# Setup for booting from MMC
#

kernel=zImage
initramfs=initramfs.uImage

mmc_args=setenv bootargs console=${console} rdinit=init

mmc_loadzimage=if load mmc ${mmcdev} ${loadaddr} ${kernel}; then echo Loaded ${kernel}; else echo Failed to load ${kernel}; fi
mmc_loadfdt=if load mmc ${mmcdev} ${fdtaddr} ${fdtfile}; then echo Loaded ${loadfdt}; else echo Failed to load ${loadfdt}; fi

#mmc_loadinitramfs=if load mmc ${mmcdev} ${rdaddr} ${initramfs}; then echo Loaded ${initramfs}; else echo Failed to load ${initramfs}; fi

#mmc_load_system=run mmc_args; run mmc_loadzimage && run mmc_loadfdt && run mmc_loadinitramfs
#mmc_bootz=bootz ${loadaddr} ${rdaddr} ${fdtaddr}

mmc_load_system=run mmc_args; run mmc_loadzimage && run mmc_loadfdt
mmc_bootz=bootz ${loadaddr} - ${fdtaddr}

mmc_bootcmd=run mmc_args; if run mmc_load_system; then run mmc_bootz; else echo Load failed; fi;

save_distro_bootcmd=env set -f distro_bootcmd_orig ${distro_bootcmd};
disable_distro_bootcmd=env set -f distro_bootcmd echo Disabled distro_bootcmd (See distro_bootcmd_orig);

stall_boot=run save_distro_bootcmd; run disable_distro_bootcmd; echo Boot stalled by disabled distro_bootcmd;

#uenvcmd=run stall_boot; echo To boot, use: run mmc_bootcmd;
uenvcmd=run mmc_bootcmd;
