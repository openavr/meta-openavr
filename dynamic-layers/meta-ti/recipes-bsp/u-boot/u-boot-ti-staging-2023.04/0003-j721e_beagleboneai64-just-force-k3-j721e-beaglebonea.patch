From 08217053545deb5b9d895ba4ee3283958355a97d Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Sun, 20 Aug 2023 19:53:34 -0500
Subject: [PATCH] j721e_beagleboneai64: just force k3-j721e-beagleboneai64

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/mach-k3/j721e_init.c           | 2 +-
 board/ti/j721e/evm.c                    | 3 +--
 board/ti/j721e/j721e.env                | 2 +-
 configs/j721e_beagleboneai64_a72.config | 6 +++---
 4 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/arch/arm/mach-k3/j721e_init.c b/arch/arm/mach-k3/j721e_init.c
index 5621906fd5..b88b54d214 100644
--- a/arch/arm/mach-k3/j721e_init.c
+++ b/arch/arm/mach-k3/j721e_init.c
@@ -339,7 +339,7 @@ u32 spl_mmc_boot_mode(struct mmc *mmc, const u32 boot_device)
 {
 	switch (boot_device) {
 	case BOOT_DEVICE_MMC1:
-		return (spl_mmc_emmc_boot_partition(mmc) ? MMCSD_MODE_EMMCBOOT : MMCSD_MODE_FS);
+		return MMCSD_MODE_FS;
 	case BOOT_DEVICE_MMC2:
 		return MMCSD_MODE_FS;
 	default:
diff --git a/board/ti/j721e/evm.c b/board/ti/j721e/evm.c
index d0077cebc4..a3af4a7e92 100644
--- a/board/ti/j721e/evm.c
+++ b/board/ti/j721e/evm.c
@@ -467,8 +467,7 @@ static void setup_board_eeprom_env(void)
 	else if (board_is_j7200_som())
 		name = "j7200";
 	else
-		printf("Unidentified board claims %s in eeprom header\n",
-		       board_ti_get_name());
+		name = "BBONEAI-64-B0-";
 
 invalid_eeprom:
 	set_board_info_env_am6(name);
diff --git a/board/ti/j721e/j721e.env b/board/ti/j721e/j721e.env
index 8edbdd7ad6..2333c57e8b 100644
--- a/board/ti/j721e/j721e.env
+++ b/board/ti/j721e/j721e.env
@@ -12,7 +12,7 @@ defined(CONFIG_TARGET_J721E_R5_EVM)
 #include <environment/ti/k3_rproc.env>
 #endif
 
-default_device_tree=ti/k3-j721e-common-proc-board.dtb
+default_device_tree=k3-j721e-beagleboneai64.dtb
 findfdt=
 	setenv name_fdt ${default_device_tree};
 	if test $board_name = j721e; then
diff --git a/configs/j721e_beagleboneai64_a72.config b/configs/j721e_beagleboneai64_a72.config
index e77c67962d..57abc98a17 100644
--- a/configs/j721e_beagleboneai64_a72.config
+++ b/configs/j721e_beagleboneai64_a72.config
@@ -1,9 +1,9 @@
 # Defconfig fragment to apply on top of j721e_evm_a72_defconfig
 
 CONFIG_DEFAULT_DEVICE_TREE="k3-j721e-beagleboneai64"
-CONFIG_SPL_OF_LIST="k3-j721e-beagleboneai64 k3-j721e-sk"
-CONFIG_OF_LIST="k3-j721e-beagleboneai64 k3-j721e-sk"
-CONFIG_BOOTCOMMAND="run findfdt; run envboot; run distro_bootcmd"
+CONFIG_SPL_OF_LIST="k3-j721e-beagleboneai64"
+CONFIG_OF_LIST="k3-j721e-beagleboneai64"
+CONFIG_BOOTCOMMAND="run distro_bootcmd"
 CONFIG_EXT4_WRITE=y
 CONFIG_LZO=y
 CONFIG_AUTOBOOT_KEYED=y
-- 
2.34.1

